{% extends "base.html" %}
{% block content %}
<h1 class="text-xl font-semibold mb-1">Ordre {{ co.code }}</h1>
<div class="mb-3 text-sm text-zinc-600">
  Kunde: {% if co.customer %}<span class="font-medium">{{ co.customer.name }}</span>{% else %}<span class="italic">Ukjent</span>{% endif %}
</div>

<div class="grid md:grid-cols-2 gap-4">
  <section class="rounded-2xl border border-zinc-200 bg-white p-3">
    <h2 class="font-semibold mb-2">Linjer</h2>
    <table class="w-full text-sm">
      <thead class="bg-zinc-100">
        <tr>
          <th class="p-2 text-left">Vare</th>
          <th class="p-2">Bestilt</th>
          <th class="p-2">Reservert</th>
          <th class="p-2">Levert</th>
          <th class="p-2"></th>
        </tr>
      </thead>
      <tbody>
        {% for l in lines %}
        <tr class="odd:bg-zinc-50 align-top">
          <td class="p-2">
            {% if l.item %}
              <a href="/item/{{ l.item_id }}/units" class="underline hover:no-underline">{{ l.item.name }}</a>
              <div class="text-xs text-zinc-500">{{ l.item.sku }}</div>
            {% else %}
              {{ l.item_id }}
            {% endif %}
          </td>
          <td class="p-2 text-center">{{ l.qty }}</td>
          <td class="p-2 text-center">{{ l.qty_reserved }}</td>
          <td class="p-2 text-center">{{ l.qty_fulfilled }}</td>
          <td class="p-2">
            <div class="flex flex-wrap gap-2 items-center">
              <form method="post" action="/co/{{ co.id }}/line/order" class="flex items-center gap-1">
                <input type="hidden" name="item_id" value="{{ l.item_id }}">
                <input type="number" name="qty" value="1" min="1" class="w-16 px-2 py-1 rounded border">
                <button class="px-2 py-1 rounded border">Bestill</button>
              </form>

              <form method="post" action="/co/{{ co.id }}/reserve" class="flex items-center gap-1">
                <input type="hidden" name="item_id" value="{{ l.item_id }}">
                <input type="number" name="qty" value="1" min="1" class="w-16 px-2 py-1 rounded border">
                <button class="px-2 py-1 rounded border">Reserver</button>
              </form>

              <form method="post" action="/co/{{ co.id }}/release" class="flex items-center gap-1">
                <input type="hidden" name="item_id" value="{{ l.item_id }}">
                <input type="number" name="qty" value="1" min="1" class="w-16 px-2 py-1 rounded border">
                <button class="px-2 py-1 rounded border">Frigi</button>
              </form>

              <form method="post" action="/co/{{ co.id }}/fulfill" class="flex items-center gap-1">
                <input type="hidden" name="item_id" value="{{ l.item_id }}">
                <input type="number" name="qty" value="1" min="1" class="w-16 px-2 py-1 rounded border">
                <button class="px-2 py-1 rounded bg-emerald-600 text-white">Utlever</button>
              </form>

              <form method="post" action="/co/{{ co.id }}/unfulfill" class="flex items-center gap-1">
                <input type="hidden" name="item_id" value="{{ l.item_id }}">
                <input type="number" name="qty" value="1" min="1" class="w-16 px-2 py-1 rounded border">
                <button class="px-2 py-1 rounded border">Trekk</button>
              </form>

              <form method="post" action="/co/{{ co.id }}/receive" class="flex items-center gap-1">
                <input type="hidden" name="item_id" value="{{ l.item_id }}">
                <input type="number" name="qty" value="1" min="1" class="w-16 px-2 py-1 rounded border" title="Antall">
                <input type="text" name="po_code" placeholder="PO-2025-001" class="w-36 px-2 py-1 rounded border" title="PO-kode">
                <button class="px-2 py-1 rounded border">Motta</button>
              </form>

              <form method="post" action="/co/{{ co.id }}/line/delete" class="flex items-center gap-1" onsubmit="return confirm('Slette linje og oppheve reservasjoner?');">
                <input type="hidden" name="item_id" value="{{ l.item_id }}">
                <button class="px-2 py-1 rounded bg-rose-600 text-white">Slett linje</button>
              </form>
            </div>
          </td>
        </tr>
        {% endfor %}
        {% if lines|length == 0 %}
          <tr><td class="p-3 text-zinc-500" colspan="5">Ingen linjer ennå.</td></tr>
        {% endif %}
      </tbody>
    </table>
  </section>

  <section class="rounded-2xl border border-zinc-200 bg-white p-3 space-y-3">
    <h2 class="font-semibold mb-2">Handlinger</h2>
    <form method="post" action="/co/{{ co.id }}/release" class="grid grid-cols-3 gap-2">
      <input name="item_id" class="px-3 py-2 rounded border" placeholder="Item ID" required>
      <input type="number" name="qty" class="px-3 py-2 rounded border" placeholder="Antall" min="1" value="1" required>
      <button class="px-3 py-2 rounded bg-amber-600 text-white">Frigi</button>
    </form>
    <form method="post" action="/co/{{ co.id }}/fulfill" class="grid grid-cols-3 gap-2">
      <input name="item_id" class="px-3 py-2 rounded border" placeholder="Item ID" required>
      <input type="number" name="qty" class="px-3 py-2 rounded border" placeholder="Antall" min="1" value="1" required>
      <button class="px-3 py-2 rounded bg-emerald-600 text-white">Utlever</button>
    </form>
    <div class="text-xs text-zinc-500">Tips: Reserver fra varesiden (Enheter) for å binde konkrete enheter til denne CO.</div>
  </section>
</div>
{% endblock %}
